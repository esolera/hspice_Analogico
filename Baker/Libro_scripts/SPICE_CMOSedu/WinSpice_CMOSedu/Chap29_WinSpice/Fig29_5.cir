*** Figure 29.5 CMOS: Circuit Design, Layout, and Simulation ***

*#destroy all
*#run
*#plot vin vout

VDD VDD 0 5
XX2 D2 D2i VDD inverter
XX3 D1 D1i VDD inverter
XX4 D0 D0i VDD inverter
Vclock1 N045 0 PULSE(0 5 5n 100p 100p 4.9n 10n)
Vin1 Vin 0 SINE(2.5 2.5 2MEG)
XX1 N043 0 Vout ideal_op_amp
R1 N043 N044 1k
XX5 D0 D1 D2 D3 D4 D5 D6 D7 D8 D9 Vin VDD 0 N045 VDD ideal_10_bit_adc
XX6 D5 D5i VDD inverter
XX7 D4 D4i VDD inverter
XX8 D3 D3i VDD inverter
XX9 D6 D6i VDD inverter
XX10 D9 D9i VDD inverter
XX11 D8 D8i VDD inverter
XX12 D7 D7i VDD inverter
R2 N020 N031 1k
R3 N031 N042 1k
R4 N020 N030 1k
R5 N030 N041 1k
XX13 N041 0 D0i VDD switch_1
XX14 N041 N043 D0 VDD switch_1
XX15 N042 0 VDD VDD switch_1
XX16 N042 0 VDD VDD switch_1
R6 N018 N019 1k
XX17 N020 N019 VDD VDD switch_1
R7 N018 N029 1k
R8 N029 N040 1k
XX18 N040 0 D1i VDD switch_1
XX19 N040 N043 D1 VDD switch_1
R9 N016 N017 1k
XX20 N018 N017 VDD VDD switch_1
R10 N016 N028 1k
R11 N028 N039 1k
XX21 N039 0 D2i VDD switch_1
XX22 N039 N043 D2 VDD switch_1
R12 N014 N015 1k
XX23 N016 N015 VDD VDD switch_1
R13 N014 N027 1k
R14 N027 N038 1k
XX24 N038 0 D3i VDD switch_1
XX25 N038 N043 D3 VDD switch_1
R15 N012 N013 1k
XX26 N014 N013 VDD VDD switch_1
R16 N012 N026 1k
R17 N026 N037 1k
XX27 N037 0 D4i VDD switch_1
XX28 N037 N043 D4 VDD switch_1
R18 N010 N011 1k
XX29 N012 N011 VDD VDD switch_1
R19 N010 N025 1k
R20 N025 N036 1k
XX30 N036 0 D5i VDD switch_1
XX31 N036 N043 D5 VDD switch_1
R21 N008 N009 1k
XX32 N010 N009 VDD VDD switch_1
R22 N008 N024 1k
R23 N024 N035 1k
XX33 N035 0 D6i VDD switch_1
XX34 N035 N043 D6 VDD switch_1
R24 N006 N007 1k
XX35 N008 N007 VDD VDD switch_1
R25 N006 N023 1k
R26 N023 N034 1k
XX36 N034 0 D7i VDD switch_1
XX37 N034 N043 D7 VDD switch_1
R27 N004 N005 1k
XX38 N006 N005 VDD VDD switch_1
R28 N004 N022 1k
R29 N022 N033 1k
XX39 N033 0 D8i VDD switch_1
XX40 N033 N043 D8 VDD switch_1
R30 N002 N003 1k
XX41 N004 N003 VDD VDD switch_1
R31 N002 N021 1k
R32 N021 N032 1k
XX42 N032 0 D9i VDD switch_1
XX43 N032 N043 D9 VDD switch_1
R33 VDD N001 1k
XX44 N002 N001 VDD VDD switch_1
R34 N044 Vout 1k

* block symbol definitions
.subckt inverter In Out VDD
S3 Out VDD N001 In switmod
S4 0 Out In N001 switmod
E1 N001 0 VDD 0 0.5
.model switmod SW
.ends inverter

.subckt ideal_op_amp Vinm Vinp Out
E1 Out 0 Vinp Vinm 1000MEG
.ends ideal_op_amp

.subckt ideal_10_bit_adc B0 B1 B2 B3 B4 B5 B6 B7 B8 B9 Vin Vrefp Vrefm Clock VDD
R1 Vtrip 0 100MEG
R2 VDD Vtrip 100MEG
B1 VCM 0 V=(V(VREFP)-V(VREFM))/2
BPIP PIPIN 0 V=V(OUTSH)-V(VREFM)+((V(VREFP)-V(VREFM))/2048)
XU2 VDD Vtrip VCM N001 B7 N003 adcbit
XU3 VDD Vtrip VCM N003 B6 N005 adcbit
XU4 VDD Vtrip VCM N005 B5 N008 adcbit
XU5 VDD Vtrip VCM N008 B4 N002 adcbit
XU1 VDD Vtrip VCM N002 B3 N004 adcbit
XU7 VDD Vtrip VCM N004 B2 N006 adcbit
XU8 VDD Vtrip VCM N006 B1 N009 adcbit
XU9 VDD Vtrip VCM N009 B0 NC_01 adcbit
XU10 Vin OUTSH clock VDD sample_and_hold
XU12 VDD Vtrip VCM PIPIN B9 N007 adcbit
XU13 VDD Vtrip VCM N007 B8 N001 adcbit
.ends ideal_10_bit_adc

.subckt switch_1 P1 P2 clk VDD
S1 P2 P1 clk Vtrip switmod
R1 Vtrip 0 100MEG
R2 VDD Vtrip 100MEG
.model switmod SW
.ends switch_1

.subckt adcbit VDD Vtrip VCM Vin Bitout Vout
S3 Bitout VDD Vin VCM switmod
S4 0 Bitout VCM Vin switmod
S5 Vout Vinh Bitout Vtrip switmod
S6 Vinl Vout Vtrip Bitout switmod
E1 Vinh 0 Vin VCM 2
E2 Vinl 0 Vin 0 2
.model switmod SW
.ends adcbit

.subckt sample_and_hold Vin Outsh Clock VDD
S1 Vins Vinb Vtrip Clock switmod
C1 Vins 0 1e-10
S2 N001 Vins clock Vtrip switmod
C2 N001 0 1e-16
R1 Vtrip 0 100MEG
R2 VDD Vtrip 100MEG
Ebufout Outsh 0 N001 0 1
Ebufin Vinb 0 Vin 0 1
.model switmod SW
.ends sample_and_hold

.tran 0 1000n 0 .1n uic
.options plotwinsize=0

.end
