*** Figure 29.5_V2 CMOS: Circuit Design, Layout, and Simulation ***

*#destroy all
*#run
*#plot vin vout

VDD VDD 0 5
XX2 D2 D2i VDD inverter
XX3 D1 D1i VDD inverter
XX4 D0 D0i VDD inverter
Vclock1 N042 0 PULSE(0 5 5n 100p 100p 4.9n 10n)
Vin1 Vin 0 SINE(2.5 2.5 2MEG)
XX1 Vout N001 Vout ideal_op_amp
XX5 D0 D1 D2 D3 D4 D5 D6 D7 D8 D9 Vin VDD 0 N042 VDD ideal_10_bit_adc
XX6 D5 D5i VDD inverter
XX7 D4 D4i VDD inverter
XX8 D3 D3i VDD inverter
XX9 D6 D6i VDD inverter
XX10 D9 D9i VDD inverter
XX11 D8 D8i VDD inverter
XX12 D7 D7i VDD inverter
R2 N019 N030 1k
R3 N030 N041 1k
R4 N019 N029 1k
R5 N029 N040 1k
XX13 N040 0 D0i VDD switch_1
XX14 N040 VDD D0 VDD switch_1
XX15 N041 0 VDD VDD switch_1
XX16 N041 0 VDD VDD switch_1
R6 N017 N018 1k
XX17 N019 N018 VDD VDD switch_1
R7 N017 N028 1k
R8 N028 N039 1k
XX18 N039 0 D1i VDD switch_1
XX19 N039 VDD D1 VDD switch_1
R9 N015 N016 1k
XX20 N017 N016 VDD VDD switch_1
R10 N015 N027 1k
R11 N027 N038 1k
XX21 N038 0 D2i VDD switch_1
XX22 N038 VDD D2 VDD switch_1
R12 N013 N014 1k
XX23 N015 N014 VDD VDD switch_1
R13 N013 N026 1k
R14 N026 N037 1k
XX24 N037 0 D3i VDD switch_1
XX25 N037 VDD D3 VDD switch_1
R15 N011 N012 1k
XX26 N013 N012 VDD VDD switch_1
R16 N011 N025 1k
R17 N025 N036 1k
XX27 N036 0 D4i VDD switch_1
XX28 N036 VDD D4 VDD switch_1
R18 N009 N010 1k
XX29 N011 N010 VDD VDD switch_1
R19 N009 N024 1k
R20 N024 N035 1k
XX30 N035 0 D5i VDD switch_1
XX31 N035 VDD D5 VDD switch_1
R21 N007 N008 1k
XX32 N009 N008 VDD VDD switch_1
R22 N007 N023 1k
R23 N023 N034 1k
XX33 N034 0 D6i VDD switch_1
XX34 N034 VDD D6 VDD switch_1
R24 N005 N006 1k
XX35 N007 N006 VDD VDD switch_1
R25 N005 N022 1k
R26 N022 N033 1k
XX36 N033 0 D7i VDD switch_1
XX37 N033 VDD D7 VDD switch_1
R27 N003 N004 1k
XX38 N005 N004 VDD VDD switch_1
R28 N003 N021 1k
R29 N021 N032 1k
XX39 N032 0 D8i VDD switch_1
XX40 N032 VDD D8 VDD switch_1
R30 N001 N002 1k
XX41 N003 N002 VDD VDD switch_1
R31 N001 N020 1k
R32 N020 N031 1k
XX42 N031 0 D9i VDD switch_1
XX43 N031 VDD D9 VDD switch_1

* block symbol definitions
.subckt inverter In Out VDD
S3 Out VDD N001 In switmod
S4 0 Out In N001 switmod
E1 N001 0 VDD 0 0.5
.model switmod SW
.ends inverter

.subckt ideal_op_amp Vinm Vinp Out
E1 Out 0 Vinp Vinm 1000MEG
.ends ideal_op_amp

.subckt ideal_10_bit_adc B0 B1 B2 B3 B4 B5 B6 B7 B8 B9 Vin Vrefp Vrefm Clock VDD
R1 Vtrip 0 100MEG
R2 VDD Vtrip 100MEG
B1 VCM 0 V=(V(VREFP)-V(VREFM))/2
BPIP PIPIN 0 V=V(OUTSH)-V(VREFM)+((V(VREFP)-V(VREFM))/2048)
XU2 VDD Vtrip VCM N001 B7 N003 adcbit
XU3 VDD Vtrip VCM N003 B6 N005 adcbit
XU4 VDD Vtrip VCM N005 B5 N008 adcbit
XU5 VDD Vtrip VCM N008 B4 N002 adcbit
XU1 VDD Vtrip VCM N002 B3 N004 adcbit
XU7 VDD Vtrip VCM N004 B2 N006 adcbit
XU8 VDD Vtrip VCM N006 B1 N009 adcbit
XU9 VDD Vtrip VCM N009 B0 NC_01 adcbit
XU10 Vin OUTSH clock VDD sample_and_hold
XU12 VDD Vtrip VCM PIPIN B9 N007 adcbit
XU13 VDD Vtrip VCM N007 B8 N001 adcbit
.ends ideal_10_bit_adc

.subckt switch_1 P1 P2 clk VDD
S1 P2 P1 clk Vtrip switmod
R1 Vtrip 0 100MEG
R2 VDD Vtrip 100MEG
.model switmod SW
.ends switch_1

.subckt adcbit VDD Vtrip VCM Vin Bitout Vout
S3 Bitout VDD Vin VCM switmod
S4 0 Bitout VCM Vin switmod
S5 Vout Vinh Bitout Vtrip switmod
S6 Vinl Vout Vtrip Bitout switmod
E1 Vinh 0 Vin VCM 2
E2 Vinl 0 Vin 0 2
.model switmod SW
.ends adcbit

.subckt sample_and_hold Vin Outsh Clock VDD
S1 Vins Vinb Vtrip Clock switmod
C1 Vins 0 1e-10
S2 N001 Vins clock Vtrip switmod
C2 N001 0 1e-16
R1 Vtrip 0 100MEG
R2 VDD Vtrip 100MEG
Ebufout Outsh 0 N001 0 1
Ebufin Vinb 0 Vin 0 1
.model switmod SW
.ends sample_and_hold

.tran 0 1000n 0 .1n uic
.options plotwinsize=0

.end

